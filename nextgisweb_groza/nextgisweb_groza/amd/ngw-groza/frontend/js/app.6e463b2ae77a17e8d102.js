webpackJsonp([1],{"7zck":function(t,n){},AGWN:function(t,n){},AOrw:function(t,n){},EYnv:function(t,n){},NHnr:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("7+uW"),i=e("3EgV"),o=e.n(i),r=e("K/Lq"),s=e.n(r),u={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"app"}},[n("v-app",[n("router-view")],1)],1)},staticRenderFns:[]};var c=e("VU/8")({name:"App"},u,!1,function(t){e("AOrw")},null,null).exports,l=e("/ocq"),d=(e("nrd6"),{name:"Map",mounted:function(){this.initMap()},methods:{initMap:function(){var t=this;this.$store.dispatch("NGW_WEB_MAP").then(function(n){var e=n.data;if(e.success){var a=e.data;t.map=L.map("map"),t.map.fitBounds(a.extent)}})}}}),p={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"map"}})},staticRenderFns:[]};var f={name:"Monitoring",components:{"app-map":e("VU/8")(d,p,!1,function(t){e("ZZnw")},"data-v-0fbde2dd",null).exports}},v={render:function(){var t=this.$createElement;return(this._self._c||t)("app-map")},staticRenderFns:[]};var m=e("VU/8")(f,v,!1,function(t){e("cyT6")},"data-v-08237d1a",null).exports,h={render:function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("history")])},staticRenderFns:[]};var g=e("VU/8")({name:"History"},h,!1,function(t){e("z5fQ")},"data-v-3b96e6fa",null).exports,_={name:"Login",data:function(){return{valid:!1,authFail:!1,login:"",loginRules:[function(t){return!!t||"Логин обязателен"}],password:"",pswRules:[function(t){return!!t||"Пароль обязателен"}]}},methods:{submit:function(){var t=this,n=this.login,e=this.password,a=this;this.$store.dispatch("AUTH_REQUEST",{login:n,password:e}).then(function(n){n?(t.authFail=!1,a.$router.push("/")):t.authFail=!0})}}},E={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-content",[e("v-container",{attrs:{fluid:"","fill-height":""}},[e("v-layout",{attrs:{"align-center":"","justify-center":""}},[e("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},[e("v-card",{staticClass:"elevation-12"},[e("v-toolbar",{attrs:{dark:"",color:"primary"}},[e("v-toolbar-title",[t._v("Авторизация")])],1),t._v(" "),e("v-card-text",[e("v-form",{on:{submit:t.submit},model:{value:t.valid,callback:function(n){t.valid=n},expression:"valid"}},[e("v-text-field",{attrs:{rules:t.loginRules,"prepend-icon":"person",name:"login",label:"Логин",type:"text"},model:{value:t.login,callback:function(n){t.login=n},expression:"login"}}),t._v(" "),e("v-text-field",{attrs:{rules:t.pswRules,"prepend-icon":"lock",name:"password",label:"Пароль",id:"password",type:"password"},model:{value:t.password,callback:function(n){t.password=n},expression:"password"}})],1),t._v(" "),e("div",[e("v-alert",{attrs:{type:"error",dismissible:""},model:{value:t.authFail,callback:function(n){t.authFail=n},expression:"authFail"}},[t._v("\n                Вход не выполнен\n              ")])],1)],1),t._v(" "),e("v-card-actions",[e("v-spacer"),t._v(" "),e("v-btn",{attrs:{disabled:!t.valid,color:"primary"},nativeOn:{click:function(n){return t.submit(n)}}},[t._v("Войти")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var U,R,w,T,b=e("VU/8")(_,E,!1,function(t){e("AGWN")},"data-v-1aa38d2a",null).exports,S=e("NYxO"),A=e("bOdI"),O=e.n(A),x={state:{status:"",profile:{}},getters:{getProfile:function(t){return t.profile},isProfileLoaded:function(t){return!!t.profile.name}},actions:O()({},"USER_REQUEST",function(t){var n=t.commit;t.dispatch;n("USER_REQUEST")}),mutations:(U={},O()(U,"USER_REQUEST",function(t){t.status="loading"}),O()(U,"USER_SUCCESS",function(t,n){t.status="success",a.a.set(t,"profile",n)}),O()(U,"USER_ERROR",function(t){t.status="error"}),O()(U,"AUTH_LOGOUT",function(t){t.profile={}}),U)},y=e("//Fk"),H=e.n(y),k={authCookie:"true"===s.a.get("groza")||!1,status:"",hasLoadedOnce:!1},z={isAuthenticated:function(){return k.authCookie},authStatus:function(){return k.status}},C=(R={},O()(R,"AUTH_REQUEST",function(t,n){var e=t.commit,a=t.dispatch;return new H.a(function(t,i){e("AUTH_REQUEST"),a("NGW_LOGIN",n).then(function(n){!0===n.data.login?(e("AUTH_SUCCESS"),a("USER_REQUEST"),t(!0)):(s.a.delete("groza"),t(!1))}).catch(function(t){e("AUTH_ERROR",t),s.a.delete("groza"),i(t)})})}),O()(R,"AUTH_LOGOUT",function(t){var n=t.commit;t.dispatch;return new H.a(function(t,e){n("AUTH_LOGOUT"),s.a.delete("groza"),t()})}),R),F=(w={},O()(w,"AUTH_REQUEST",function(t){t.status="loading"}),O()(w,"AUTH_SUCCESS",function(t){t.status="success",s.a.set("groza",!0),t.authCookie=!0,t.hasLoadedOnce=!0}),O()(w,"AUTH_ERROR",function(t){t.status="error",t.hasLoadedOnce=!0}),O()(w,"AUTH_LOGOUT",function(t){s.a.delete("groza")}),w),G={state:k,getters:z,actions:C,mutations:F},N=e("mtWM"),Q=e.n(N),W=e("mw3O"),M=e.n(W),$=Q.a.create({baseURL:window.grozaConfig.ngwUrl}),V={state:{},getters:{},actions:(T={},O()(T,"NGW_LOGIN",function(t,n){t.commit,t.dispatch;return $.post("/api/groza/login",M.a.stringify(n))}),O()(T,"NGW_WEB_MAP",function(t){t.commit,t.dispatch;var n=window.grozaConfig.settings.web_map;return $.get("/api/groza/webmap/"+n+"/")}),T),mutations:{}};a.a.use(S.a);var P=new S.a.Store({modules:{user:x,auth:G,ngw:V},strict:!1});a.a.use(l.a);var j=function(t,n,e){P.getters.isAuthenticated?e():e("/login")},Z=new l.a({mode:"hash",routes:[{path:"/",name:"Monitoring",component:m,beforeEnter:j},{path:"/history",name:"History",component:g,beforeEnter:j},{path:"/login",name:"Login",component:b,beforeEnter:function(t,n,e){P.getters.isAuthenticated?e("/"):e()}}]});e("j1ja"),e("7zck"),e("EYnv");a.a.config.productionTip=!1,a.a.use(o.a,{theme:{primary:"#016fc5"}}),a.a.use(s.a),new a.a({el:"#app",store:P,router:Z,components:{App:c},template:"<App />"})},ZZnw:function(t,n){},cyT6:function(t,n){},z5fQ:function(t,n){}},["NHnr"]);
//# sourceMappingURL=app.6e463b2ae77a17e8d102.js.map